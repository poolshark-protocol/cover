specVersion: 0.0.4
description: Poolshark is a Directional Liquidity AMM allowing LPs to capture directional strength.
repository: https://github.com/poolsharks-protocol/poolshark-cover-pool
schema:
    file: ./schema.graphql
dataSources:
    - kind: ethereum/contract
      name: CoverPoolFactory
      network: arbitrum-goerli
      source:
          address: '0xc4230d3f673a44bf125c94effd1a6cc44202e0b8'
          abi: CoverPoolFactory
          startBlock: 52612037
      mapping:
          kind: ethereum/events
          apiVersion: 0.0.6
          language: wasm/assemblyscript
          file: ./src/mappings/coverpoolfactory.ts
          entities:
              - Token
              - CoverPool
          abis:
              - name: CoverPool
                file: ./abis/CoverPool.json
              - name: CoverPoolFactory
                file: ./abis/CoverPoolFactory.json
              - name: ERC20
                file: ./abis/ERC20.json
              - name: ERC20SymbolBytes
                file: ./abis/ERC20SymbolBytes.json
              - name: ERC20NameBytes
                file: ./abis/ERC20NameBytes.json
          eventHandlers:
              - event: PoolCreated(address,indexed address,address,address,uint16,int16,uint16,indexed uint8)
                handler: handlePoolCreated
    - kind: ethereum/contract
      name: CoverPoolManager
      network: arbitrum-goerli
      source:
          address: '0x87131ccc50786e387cfebcaafa522073a8e43548'
          abi: CoverPoolManager
          startBlock: 52612031
      mapping:
          kind: ethereum/events
          apiVersion: 0.0.6
          language: wasm/assemblyscript
          file: ./src/mappings/coverpoolmanager.ts
          entities:
              - CoverPool
              - CoverPoolFactory
          abis:
              - name: CoverPoolManager
                file: ./abis/CoverPoolManager.json
          eventHandlers:
              - event: PoolTypeEnabled(uint8,bytes32,address,address,address)
                handler: handlePoolTypeEnabled
              - event: VolatilityTierEnabled(uint8,uint16,int16,uint16,uint128,uint16,uint16,uint16,uint16,int16,bool)
                handler: handleVolatilityTierEnabled
              - event: FeeToTransfer(indexed address,indexed address)
                handler: handleFeeToTransfer
              - event: OwnerTransfer(indexed address,indexed address)
                handler: handleOwnerTransfer
              - event: ProtocolFeesCollected(address[],uint128[],uint128[])
                handler: handleProtocolFeesCollected
              - event: FactoryChanged(indexed address,indexed address)
                handler: handleFactoryChanged
    - kind: ethereum/contract
      name: PoolsharkRouter
      network: arbitrum-goerli
      source:
          address: '0x6ccccc845849b76f3acb3affcca28a6035e41a20'
          abi: PoolsharkRouter
          startBlock: 52612031
      mapping:
          kind: ethereum/events
          apiVersion: 0.0.6
          language: wasm/assemblyscript
          file: ./src/mappings/coverpoolrouter.ts
          entities:
              - PoolsharkRouter
          abis:
              - name: PoolsharkRouter
                file: ./abis/PoolsharkRouter.json
          eventHandlers:
              - event: RouterDeployed(address,address,address)
                handler: handleRouterDeployed
templates:
    # Cover Pool Events
    - kind: ethereum/contract
      name: CoverPoolTemplate
      network: arbitrum-goerli
      source:
          abi: CoverPool
      mapping:
          kind: ethereum/events
          apiVersion: 0.0.6
          language: wasm/assemblyscript
          file: ./src/mappings/coverpool.ts
          entities:
              - Token
              - CoverPool
              - Position
          abis:
              - name: CoverPool
                file: ./abis/CoverPool.json
              - name: CoverPoolFactory
                file: ./abis/CoverPoolFactory.json
              - name: ERC20
                file: ./abis/ERC20.json
              - name: ERC20SymbolBytes
                file: ./abis/ERC20SymbolBytes.json
              - name: ERC20NameBytes
                file: ./abis/ERC20NameBytes.json
          eventHandlers:
              - event: Initialize(int24,int24,int24,uint32,uint32,uint160,uint160)
                handler: handleInitialize
              - event: Mint(indexed address,int24,int24,bool,uint32,uint32,uint128,uint128,uint128,uint128)
                handler: handleMint
              - event: Burn(indexed address,uint32,int24,bool,uint128,uint128,uint128,uint128,uint128,uint128,uint128,uint128,uint160)
                handler: handleBurn
              - event: SwapPool0(indexed address,uint128,uint128,uint160,uint160)
                handler: handleSwapPool0
              - event: SwapPool1(indexed address,uint128,uint128,uint160,uint160)
                handler: handleSwapPool1
              - event: Sync(uint160,uint160,uint128,uint128,uint32,uint32,int24,int24)
                handler: handleSync
              - event: FinalDeltasAccumulated(uint128,uint128,uint32,int24,bool)
                handler: handleFinalDeltasAccumulated
              - event: StashDeltasAccumulated(uint128,uint128,uint128,uint128,uint32,int24,bool)
                handler: handleStashDeltasAccumulated
              - event: StashDeltasCleared(int24,bool)
                handler: handleStashDeltasCleared
    # TwapSource events
    - kind: ethereum/contract
      name: TwapSourceTemplate
      network: arbitrum-goerli
      source:
          abi: TwapSource
      mapping:
          kind: ethereum/events
          apiVersion: 0.0.6
          language: wasm/assemblyscript
          file: ./src/mappings/twapsource.ts
          entities:
              - TwapSource
          abis:
              - name: TwapSource
                file: ./abis/TwapSource.json
          eventHandlers:
              - event: SampleCountInitialized(indexed address,uint16,uint16,uint16)
                handler: handleSampleCountInitialized
    # InputPool events
    - kind: ethereum/contract
      name: LimitSamplesTemplate
      network: arbitrum-goerli
      source:
          abi: LimitSamples
      mapping:
          kind: ethereum/events
          apiVersion: 0.0.6
          language: wasm/assemblyscript
          file: ./src/mappings/limit/samples.ts
          entities:
              - CoverPool
          abis:
              - name: LimitSamples
                file: ./abis/LimitSamples.json
          eventHandlers:
              - event: SampleRecorded(int56,uint160)
                handler: handleSampleRecorded
    # ERC-1155 events
    - kind: ethereum/contract
      name: PositionERC1155Template
      network: arbitrum-goerli
      source:
          abi: PositionERC1155
      mapping:
          kind: ethereum/events
          apiVersion: 0.0.6
          language: wasm/assemblyscript
          file: ./src/mappings/coverpool.ts
          entities:
              - Token
              - CoverPool
              - Position
          abis:
              - name: PositionERC1155
                file: ./abis/PositionERC1155.json
          eventHandlers:
              - event: TransferSingle(indexed address,indexed address,indexed address,uint256,uint256)
                handler: handleTransferSingle
              - event: TransferBatch(indexed address,indexed address,indexed address,uint256[],uint256[])
                handler: handleTransferBatch


